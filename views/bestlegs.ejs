<html>

<% include partials/head.ejs %>

    <body>

        <% include partials/side-menu.ejs %>
        <div class="container">

            <div id="stats-grid">
                <div onclick="openNav()" id='menu-label'>
                    <i class="fa fa-bars" aria-hidden="true"></i> IDL Scoreboard</div>
                <div class="row justify-content-center confirm-row stats-player-1">
                    <div class="stats-player ">
                        <div class="stats-text" id="name-player-1"  >
                            PLAYER 1
                        </div>
                    </div>
                </div>

                <div class="row justify-content-center confirm-row">
                    <div class="stats-score">
                        <div class="stats-text" id="stats-final-score">
                            8-3
                        </div>
                    </div>
                </div>

                <div class="row justify-content-center confirm-row stats-player-2">
                    <div class="stats-player ">
                        <div class="stats-text" id="name-player-2" ">
                            PLAYER 2
                        </div>
                    </div>
                </div>

                <div class="app-grid-row stats-grid-info">

                    <div class="grid-text">FINAL SCORE</div>

                </div>
               
            </div>

        </div>


        <script>
           

            
            



            function addRow(leg){
                var statsgrid = document.getElementById("stats-grid");

                var div1 = document.createElement("div");
                div1.classList.add("row", "justify-content-center", "confirm-row", "stats-stat-item");
                div1.innerHTML =
                 `
                        <div class=stats-item>
                            <div class="stats-text" id="leg-${leg}-player-1">
                               
                            </div>
                        </div>
                 `;
                 statsgrid.appendChild(div1);
                var div2 = document.createElement("div")  ;     
                div2.classList.add("row", "justify-content-center", "confirm-row", "stats-stat-title");
                div2.innerHTML =
                 `
                        <div class=stats-item-center>
                            <div class="stats-text">
                                LEG-${leg} 
                            </div>
                        </div>
                        `   ;  
                statsgrid.appendChild(div2);         
                var div3 = document.createElement("div")   ;    
                div3.classList.add("row", "justify-content-center", "confirm-row", "stats-stat-item");
                div3.innerHTML =
                 `
                        <div class=stats-item>
                            <div class="stats-text" id="leg-${leg}-player-2">
                               
                            </div>
                        </div>
                        `  ;  
                statsgrid.appendChild(div3);            
            }


            function getAllCheckouts(){
                match.scores.forEach(function(score){
                    if (score.finished){
                        var playerid
                        var totalDarts = score.visit * 3 - 3 + score.dartsthrown
                        match.players.forEach(function(player){
                            document.getElementById("name-" + player.id).innerHTML = player.playername
                            if (score.player == player.playername){
                                playerid=player.id
                            }
                        })
                        addRow(score.leg);
                        document.getElementById("leg-" + score.leg + "-" + playerid).innerHTML = totalDarts;
                    }

                })
            }
           

            function getScore(){
                var player1=0
                var player2 =0
                match.scores.forEach(function(score){
                    if(score.finished){
                        if (score.player == match.players[0].playername){
                            player1++
                        
                        }else{
                            player2 ++
                        }
                    }
                })
                document.getElementById("stats-final-score").innerHTML = player1 + " - " + player2
            }

            var match = JSON.parse(sessionStorage.match);
            var player1
            var player2
            getAllCheckouts();
            getScore()
          

        </script>

    </body>

</html>